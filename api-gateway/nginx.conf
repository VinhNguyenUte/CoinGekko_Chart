server {
    listen 8000;
    server_name _;

    # ============================
    # INGESTION SERVICE (5001)
    # ============================
    location /ingestion/ {
        # Remove /ingestion/
        rewrite ^/ingestion/(.*)$ /$1 break;

        proxy_pass http://ingestion:5001;

        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # ============================
    # ANALYSIS SERVICE (5002)
    # ============================
    location /analysis/ {
        rewrite ^/analysis/(.*)$ /$1 break;

        proxy_pass http://analysis:5002;

        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # ============================
    # PREDICTION SERVICE (5003)
    # ============================
    location /prediction/ {
        rewrite ^/prediction/(.*)$ /$1 break;

        proxy_pass http://prediction:5003;

        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # ============================
    # CLUSTERING SERVICE (5004)
    # ============================
    location /clustering/ {
        rewrite ^/clustering/(.*)$ /$1 break;

        proxy_pass http://clustering:5004;

        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # ----------------------------
    # OPTIONAL: CORS support
    # ----------------------------
    add_header Access-Control-Allow-Origin *;
    add_header Access-Control-Allow-Methods "GET, POST, PUT, PATCH, DELETE, OPTIONS";
    add_header Access-Control-Allow-Headers "Content-Type, Authorization";
}
